var Tetris=function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){const i=n(2);t.exports=i.app},function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"vec2",function(){return u}),n.d(i,"copy",function(){return l}),n.d(i,"equal",function(){return d}),n.d(i,"limit",function(){return p}),n.d(i,"makeMap",function(){return f}),n.d(i,"round",function(){return w}),n.d(i,"makeAttribute",function(){return y}),n.d(i,"add",function(){return m}),n.d(i,"sub",function(){return g}),n.d(i,"mul",function(){return v}),n.d(i,"div",function(){return b}),n.d(i,"scale",function(){return x}),n.d(i,"setScale",function(){return P}),n.d(i,"addScale",function(){return L}),n.d(i,"length",function(){return M}),n.d(i,"normalize",function(){return C}),n.d(i,"direction",function(){return R}),n.d(i,"cscale",function(){return A}),n.d(i,"csub",function(){return S}),n.d(i,"cadd",function(){return z}),n.d(i,"cmul",function(){return O});const s=void 0!==window.performance?window.performance:Date,r=()=>s.now(),a=window.requestAnimationFrame;function o(t,e=60){let n=!1,i=r(),s=0,o=1e3/e,c=0;this.start=()=>n?this:(n=!0,i=r(),s=a(h),this),this.stop=()=>(n=!1,0!=s&&a.cancel(s),s=0,this);const h=()=>{s=a(h);const e=r();(c+=e-i)-o>-1&&(t(o),c=0),i=e}}const c=[{test:"png|jpg",loader:function(t,{assetsUrl:e}){return new Promise(n=>{let i=new Image;i.onload=()=>{n(i)},i.src=e+t})}},{test:"json",loader:function(t,{assetsUrl:e}){return fetch(e+t).then(t=>t.json())}}];function h(t,e){e={assetsUrl:"",...e};let{assetsUrl:n}=e,i=[...c];const s={assetsUrl:n},r={};Object.keys(t).length;let a=0;this.progress=()=>a,this.get=t=>r[t],this.start=()=>Promise.all(Object.values(function(t,e){let n={};return Object.keys(t).forEach(i=>{n[i]=e(i,t[i])}),n}(t,(t,e)=>{return o(e)(e,s).then(e=>{r[t]=e,a++})}))).then(t=>r);const o=t=>{let[e,n]=t.split("."),s=i.find(({test:t})=>n.match(t));return s?s.loader:(console.warn(`Couldn't find loader for ${t}, ignoring.`),()=>Promise.resolve())}}function u(t=0,e=t){return[t,e]}function l(t,e=[]){return e[0]=t[0],e[1]=t[1],e}function d(t,e){return t[0]===e[0]&&t[1]===e[1]}function p(t,e){t[0]=Math.max(t[0],e[0]),t[0]=Math.min(t[0],e[1]),t[1]=Math.max(t[1],e[2]),t[1]=Math.min(t[1],e[3])}function f(t){return e=>(e[0]=t(e[0]),e[1]=t(e[1]),e)}const w=f(t=>Math.round(t));function y(t){return(e=t[0],n=t[1])=>(t[0]=e,t[1]=n,t)}function m(t,e,...n){return t[0]+=e[0],t[1]+=e[1],n.forEach(e=>{t[0]+=e[0],t[1]+=e[1]}),t}function g(t,e){return t[0]-=e[0],t[1]-=e[1],t}function v(t,e){return t[0]*=e[0],t[1]*=e[1],t}function b(t,e){return t[0]/=e[0],t[1]/=e[1],t}function x(t,e){return t[0]*=e,t[1]*=e,t}function P(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n}function L(t,e,n){return t[0]+=e[0]*n,t[1]+=e[1]*n,t}function M(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function C(t){return x(t,1/M(t)),t}function R(t,e){return C(S(e,t))}function A(t,e){return x(l(t),e)}function S(t,e){return g(l(t),e)}function z(t,e){return m(l(t),e)}function O(t,e){return v(l(t),e)}const{vec2:U}=i;function I(t){let e=this.data={touches:{}};function n(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}this.update=t=>{let{current:n,wheel:i}=e;i&&(i.handled?delete e.wheel:i.handled=!0),n&&(n.dpos=S(n.epos,n.start),n.tapping&&(n.tapping.handled?delete n.tapping:n.tapping.handled=!0),n.ending&&(n.ending.handled?delete e.current:n.ending.handled=!0))},this.bindTouch=()=>(function(t){const e=[],a=function(t){return function(e){e.preventDefault();const n=s(e);t.current={button:e.button,tapping:{},start:n,epos:n,dpos:U(0)}}}(t),o=function(t){return function(e){if(t.current){let{dpos:e}=t.current,n=r(e);t.current.ending={swipe:n}}}}(t),c=function(t){return function(e){const n=s(e);t.current&&(t.current.epos=n),t.epos=n}}(t),h=i(t);return["mousedown","touchstart"].forEach(t=>e.push(n(document,t,a))),["mousemove","touchmove"].forEach(t=>e.push(n(document,t,c))),["mouseup","touchend"].forEach(t=>e.push(n(document,t,o))),e.push(n(document,"wheel",h)),()=>{e.forEach(t=>t())}})(this.data);const i=t=>e=>{t.wheel={epos:s(e),y:Math.sign(e.deltaY)}},s=e=>{let n=(t=>t.clientX||0===t.clientX?[t.clientX,t.clientY]:t.touches&&t.targetTouches[0]?[t.targetTouches[0].clientX,t.targetTouches[0].clientY]:void 0)(e),{bounds:i}=t;return[n[0]-i.x,n[1]-i.y]};const r=t=>{let e={};return t[1]<-80?e.up=!0:t[1]>80&&(e.down=!0),t[0]<-80?e.left=!0:t[0]>80&&(e.right=!0),(e.up||e.down||e.left||e.right)&&(e.swiped=!0),e}}class j{constructor(t,e,n){this.l=t,this.c=e,this.n=n,this.p=null}r(){this.p?this.p.n=this.n:this.l.h=this.n,this.n&&(this.n.p=this.p)}}class E{constructor(){this.h=null}add(t){const e=new j(this,t,this.h);return this.h&&(this.h.p=e),this.h=e,e}i(t){let e=this.h;for(;e;)t(e.c),e=e.n}}const F={p:{t:0}};class B{constructor(t){this.z=t,this.o=new E,this.t=new E}add(t){t.remove(),t.l=this,t.n=(1!==t.a||0===t.frame.p.a?this.t:this.o).add(t)}}const Q=(t,e)=>{const n=new B(0),i=[n],s=new ArrayBuffer(3407820),r=new Float32Array(s),a=new Uint32Array(s),{Point:o}=Q,c=Object.assign({antialias:!1,alpha:!1},e),h=c.alpha?1:770,u=c.scale||1;delete c.scale;const l=t.getContext("webgl",c),d=l.getExtension("ANGLE_instanced_arrays"),p=(t,e)=>{const n=l.createShader(e);return l.shaderSource(n,t),l.compileShader(n),n},f=l.createProgram();l.attachShader(f,p("attribute vec2 g;\nattribute vec2 a;\nattribute vec2 t;\nattribute float r;\nattribute vec2 s;\nattribute vec4 u;\nattribute vec4 c;\nattribute float z;\nuniform mat4 m;\nvarying vec2 v;\nvarying vec4 i;\nvoid main(){\nv=u.xy+g*u.zw;\ni=c.abgr;\nvec2 p=(g-a)*s;\nfloat q=cos(r);\nfloat w=sin(r);\np=vec2(p.x*q-p.y*w,p.x*w+p.y*q);\np+=a+t;\ngl_Position=m*vec4(p,z,1);}",35633)),l.attachShader(f,p("precision mediump float;\nuniform sampler2D x;\nuniform float j;\nvarying vec2 v;\nvarying vec4 i;\nvoid main(){\nvec4 c=texture2D(x,v);\ngl_FragColor=c*i;\nif(j>0.0){\nif(c.a<j)discard;\ngl_FragColor.a=1.0;};}",35632)),l.linkProgram(f);const w=(t,e,n)=>{l.bindBuffer(t,l.createBuffer()),l.bufferData(t,e,n||35044)},y=(t,e,n,i,s,r,a)=>{const o=l.getAttribLocation(f,t);l.enableVertexAttribArray(o),l.vertexAttribPointer(o,e,r||5126,!!a,n||0,s||0),i&&d.vertexAttribDivisorANGLE(o,i)};w(34963,new Uint8Array([0,1,2,2,1,3])),w(34962,new Float32Array([0,0,0,1,1,0,1,1])),y("g",2),w(34962,s,35048),y("a",2,52,1),y("s",2,52,1,8),y("r",1,52,1,16),y("t",2,52,1,20),y("u",4,52,1,28),y("c",4,52,1,44,5121,!0),y("z",1,52,1,48);const m=t=>l.getUniformLocation(f,t),g=m("m"),v=m("x"),b=m("j");let x,P,L,M,C=0;const R=()=>{x=t.clientWidth*u|0,P=t.clientHeight*u|0;const e=t.width!==x||t.height!==P;return t.width=x,t.height=P,e},A=()=>{C&&(l.blendFunc(M?1:h,M?0:771),l.depthFunc(M?513:515),l.bindTexture(3553,L.p.t),l.uniform1i(v,L.p.t),l.uniform1f(b,M?L.p.a:0),l.bufferSubData(34962,0,r.subarray(0,13*C)),d.drawElementsInstancedANGLE(4,6,5121,0,C),C=0)},S=t=>{if(!t.visible)return;65535===C&&A();const{frame:e}=t,{uvs:n}=e;L.p.t!==e.p.t&&(L.p.t&&A(),L=e);let i=13*C;r[i++]=e.anchor.x,r[i++]=e.anchor.y,r[i++]=t.scale.x*e.size.x,r[i++]=t.scale.y*e.size.y,r[i++]=t.rotation,r[i++]=t.position.x,r[i++]=t.position.y,r[i++]=n[0],r[i++]=n[1],r[i++]=n[2],r[i++]=n[3],a[i++]=((16777215&t.tint)<<8|255*t.a&255)>>>0,r[i]=t.l.z,C++},z={gl:l,camera:{at:new o,to:new o,angle:0},background(t,e,n,i){l.clearColor(t,e,n,0===i?0:i||1)},layer(t){let e=i.find(e=>e.z===t);return e||(e=new B(t),i.push(e),i.sort((t,e)=>e.z-t.z)),e},add(t){n.add(t)},texture(t,e,n,i){const s=t.width,r=t.height,a=l.createTexture();return l.bindTexture(3553,a),l.texParameteri(3553,10240,9728|+n),l.texParameteri(3553,10241,9728|+n|+i<<8|+i<<1),l.texImage2D(3553,0,6408,6408,5121,t),i&&l.generateMipmap(3553),{size:new o(s,r),anchor:new o,uvs:[0,0,1,1],p:{a:0===e?0:e||1,t:a},frame(t,e,n){return{size:e,anchor:n||this.anchor,uvs:[t.x/s,t.y/r,e.x/s,e.y/r],p:this.p}}}},resize:R,render(){R();const{at:t,to:e,angle:n}=z.camera,s=t.x-x*e.x,r=t.y-P*e.y,a=Math.cos(n),o=Math.sin(n),c=2/x,h=-2/P,u=[a*c,o*h,0,0,-o*c,a*h,0,0,0,0,-1e-5,0,(t.x*(1-a)+t.y*o)*c-2*s/x-1,(t.y*(1-a)-t.x*o)*h+2*r/P+1,0,1];l.useProgram(f),l.enable(3042),l.enable(2929),l.uniformMatrix4fv(g,!1,u),l.viewport(0,0,x,P),l.clear(16640),L=F,M=!0,i.forEach(t=>t.o.i(S)),A(),M=!1;for(let t=i.length-1;t>=0;t--)i[t].t.i(S);A()}};return R(),z};Q.Point=class{constructor(t,e){if(!(this instanceof Q.Point))return new Q.Point(t,e);this.set(t,e)}set(t,e){return this.x=t||0,this.y=e||(0!==e?this.x:0),this}},Q.Sprite=class{constructor(t,e){Object.assign(this,{frame:t,visible:!0,position:new Q.Point,rotation:0,scale:new Q.Point(1),tint:16777215,a:1,l:null,n:null},e)}get width(){return this.frame.size.x*this.scale.x}set width(t){this.scale.x=t/this.frame.size.x}get height(){return this.frame.size.y*this.scale.y}set height(t){this.scale.y=t/this.frame.size.y}get alpha(){return this.a}set alpha(t){const e=t<1&&1===this.a||1===t&&this.a<1;this.a=t,e&&this.frame.p.a>0&&this.l&&this.l.add(this)}remove(){this.n&&this.n.r(),this.l=null,this.n=null}};var k=Q;function q(t){const e=this.width=t.clientWidth,n=this.height=t.clientHeight,i=document.createElement("canvas");t.appendChild(i),i.width=e,i.height=n,this.bounds=t.getBoundingClientRect();const s=k(i);this.scene=s}function D(t){return{twoLayer:t.layer(2),oneLayer:t.layer(1),zeroLayer:t.layer(0),scene:t}}const{Point:T,Sprite:_}=k;function W(t){return new _(t)}function $(t=0,e=t){return new T(t,e)}const X=(t,e,n,i=n)=>t.texture(e).frame($(),$(n,i)),G=t=>(e,n,i,s=i)=>t.frame($(e,n),$(i,s)),N=(t,e,n,i,s)=>{let r=[];for(let a=0;a<s;a++)r.push(t(e+a*i,n,i,i));return r};const Y=t=>(function(t,e,n){var i=document.createElement("canvas");return i.width=t,i.height=e,n(t,e,i,i.getContext("2d")),i})(256,256,(e,n,i,s)=>(s.fillStyle=t,s.fillRect(0,0,e,n),i));function H(t,e){this.A=t,this.B=e;this.Mid=[(t[0]+e[0])/2,(t[1]+e[1])/2];let n=e[0]-t[0],i=e[1]-t[1];this.translate=this.scale=n=>{return new H(m(A(t,1-n),A(e,n)),m(A(t,n),A(e,1-n)))},this.pointFrom=(e,s)=>{return[t[0]+n*e-i*s,t[1]+i*e+n*s]}}function V(t,e){return new H(t,e)}function J(t,e,n,i){this.width=n,this.height=i,this.x=t,this.y=e;let s=this.x1=t+n,r=this.y1=e+i,a=this.A=[t,e],o=this.B=[t,r],c=this.C=[s,r],h=this.D=[s,e];this.AB=V(a,o),this.BC=V(o,c),this.CD=V(c,h),this.DA=V(h,a),this.contains=n=>t<n.x&&e<n.y&&s>n.x1&&r>n.y1,this.intersects=n=>!(t>n.x1||n.x>s)&&!(e>n.y1||n.y>r),this.containsPoint=(n,i)=>n>t&&n<s&&i>e&&i<r}function K(t,e,n){this.x=t,this.y=e,this.radius=n;let i=this.P=[t,e];this.move=(n,i)=>{t=this.x=n,e=this.y=i},this.containsRect=t=>this.containsPoint(t.A[0],t.A[1])&&this.containsPoint(t.B[0],t.B[1])&&this.containsPoint(t.C[0],t.C[1])&&this.containsPoint(t.D[0],t.D[1]),this.containsPoint=(i,s)=>{return(t-i)*(t-i)+(e-s)*(e-s)<=n*n},this.intersectsCircle=i=>{let s=i.x-t,r=i.y-e,a=i.radius+n;return s*s+r*r<=a*a},this.intersectsRect=t=>t.containsPoint(i)||this.intersectsLine(t.AB)||this.intersectsLine(t.BC)||this.intersectsLine(t.CD)||this.intersectsLine(t.DA),this.intersectsLine=t=>!!this.containsPoint(t.A[0],t.A[1])||!!this.containsPoint(t.B[0],t.B[1])}function Z(t,e,n){return new K(t,e,n)}const{vec2:tt}=i;function et(){let t=[];this.clear=()=>t=[],this.points=()=>t,this.point=e=>{t.push(e)},this.fillCircle=(t,e)=>{let n=t.x,i=t.y,s=t.radius,r=-s,a=0,o=2-2*s;do{let t=Math.sin(r+e);this.line(V([t+n-r,i-a],[n+r,i-a])),this.line(V([t+n-r,i+a],[n+r,i+a])),(s=o)<=a&&(o+=2*++a+1),(s>r||o>a)&&(o+=2*++r+1)}while(r<0)},this.line=e=>{let n=e.A,i=S(e.B,n),s=M(i),r=A(i,1/s),a=l(n);for(let e=0;e<s;e++){let e=l(a);e[0]=Math.round(e[0]),e[1]=Math.round(e[1]),t.push(e),m(a,r)}},this.bent=(t,e=.2)=>{let n=t.pointFrom(.3,e),i=t.pointFrom(.7,e);this.bezier(n,i,t)},this.bezier=(e,n,i)=>{let s=i.A,r=i.B,a=s[0],o=s[1],c=r[0],h=r[1],u=e[0],l=e[1],d=n[0],p=n[1],f=M(S(r,s)),w=0,y=0,m=0,g=0,v=0;t.push([Math.round(s[0]),Math.round(s[1])]);for(let e=1,n=0;e<=f;e++){let i=(m=(y=(w=1-(n=e/f))*w)*w)*a+3*y*n*u+3*w*(g=n*n)*d+(v=g*n)*c,s=m*o+3*y*n*l+3*w*g*p+v*h;t.push([Math.round(i),Math.round(s)])}}}const nt={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:(4-2*t)*t-1,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1- --t*t*t*t,easeInOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1+--t*t*t*t*t,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t};function it(t,e=t,{yoyo:n}){let i=0,s=1;const r=()=>{t!==e?((()=>i=0)(),s=1):(()=>i=1)()};return{update(t){(i+=t*s)>1&&(i=1,n&&(s*=-1)),i<0&&(i=0,n&&(s*=-1))},settled:(t=1)=>i>=t,progress:(t=1)=>i,both(n,i=n){t=n,e=i,r()},target:t=>(t&&(e=t,r()),e),value:n=>(n&&(t=n,r()),(()=>t+(e-t)*i)()),easing:n=>(n=>t+(e-t)*n(i))(n)}}function st({yoyo:t,easing:e=nt.easeInOutQuad,updateRate:n=4e-4}){const i=n;let s,r=new et,a=new it(0,0,{yoyo:t}),o=new it(0,0,{});this.init=(t,e,n,i,c=.01)=>{r.clear(),r.bent(V([t,e],[n,i]),c),s=r.points(),a.both(0,1),o.both(0,1)},this.settled=()=>a.settled();const c=this.progress=()=>a.easing(e);this.currentPoint=(t=0)=>{let e=Math.floor(c()*(s.length-1));return e+=t,e=Math.min(e,s.length-1),e=Math.max(e,0),s[e]};this.update=t=>{let e=o.value();a.update(t*(i+2*i*e)),o.update(t*i)}}function rt(){let t,e;this.init=n=>{t=n,e=0},this.settled=()=>n().settled();const n=()=>t[t.length-1],i=()=>t[e];this.currentPoint=t=>i().currentPoint(t),this.update=n=>{let s=i();s.update(n),s.settled()&&e<t.length-1&&e++}}function at(t,e){for(let n of Object.keys(t))e(n,t[n])}function ot(){const t=(()=>{let t=1;return()=>t++})();let e={},n={};this.addCandy=(n,i,s)=>{e[n]||(e[n]={});let r=t();return e[n][r]={id:r,circle:i,item:s},r},this.removeCandy=(t,n)=>{delete e[t][n]},this.addRelation=(t,e,i)=>{n[t]||(n[t]={}),n[t][e]=i},this.candies=(t,n)=>{e[t]&&at(e[t],(t,{circle:e,item:i})=>{n(e,i)})},this.update=t=>{at(n,(t,n)=>{at(n,(n,i)=>{let s=e[t],r=e[n];s&&r&&at(s,(t,{circle:e,item:n})=>{at(r,(t,{circle:s,item:r})=>{e.intersectsCircle(s)&&i(n,r)})})})})}}function ct(){let t=new ot;t.addRelation("candy","lollipop",(t,e)=>{}),t.addRelation("shoot","lollipop",(t,e)=>{e.damage(t),t.damage()}),this.candies=t.candies,this.update=t.update,this.addCandy=(e,n)=>t.addCandy("candy",n,e),this.removeCandy=e=>t.removeCandy("candy",e),this.addLollipop=(e,n)=>t.addCandy("lollipop",n,e),this.removeLollipop=e=>t.removeCandy("lollipop",e),this.addShoot=(e,n)=>t.addCandy("shoot",n,e),this.removeShoot=e=>t.removeCandy("shoot",e)}function ht(t,e){e={name:"pool",warnLeak:400,...e};const n=(()=>{let t=0;return()=>t++})();let i=[],s=[];this.name=()=>e.name,this.alives=()=>i.length,this.total=()=>s.length+i.length,this.warnLeak=()=>e.warnLeak,this.toString=()=>`[${this.name()} alives: ${this.alives()} deads: ${s.length}]`,this.acquire=(e=(()=>{}))=>{let r;return this.total()>this.warnLeak()&&(console.warn(`possible pool leak at ${this.name()}.`),this.releaseLast()),e(r=s.length>0?s.pop():t(n())),i.push(r),r},this.acquireLimit=(t,e)=>{for(;this.alives()<e;)this.acquire(t)},this.release=t=>{this.releaseIndex(i.indexOf(t))},this.releaseIndex=t=>{t>-1&&s.push(i.splice(t,1)[0])},this.releaseLast=()=>{this.releaseIndex(0)},this.releaseAll=()=>{s=[...s,...i],i=[]},this.releaseIf=(t,e=(()=>{}))=>{let n=[],r=[];i.forEach(i=>{t(i)?(e(i),n.push(i)):r.push(i)}),i=r,s=[...n,...s]},this.reduce=(t,e)=>i.reduce(t,e),this.map=t=>i.map(t),this.flatMap=t=>i.flatMap(t),this.each=t=>{i.forEach(t)},this.find=t=>i.find(t)}function ut(t,e,n){const{frames:i,layers:{oneLayer:s}}=e;let r,a=new ht(()=>{return W(i.white)});this.init=t=>{r=t.collision};const o=(t,e)=>{a.acquire(n=>{n.width=2*t.radius,n.height=2*t.radius,n.position.set(t.x-.5*t.radius,t.y-.5*t.radius),n.frame=e,s.add(n)})};this.update=t=>{},this.render=()=>{a.each(t=>t.remove()),a.releaseAll(),r.candies("candy",(t,e)=>{o(t,i.white)}),r.candies("lollipop",(t,e)=>{o(t,i.white)}),r.candies("shoot",(t,e)=>{o(t,i.white)})}}function lt(t,{yoyo:e=!0}){let n=t[0],i=new it(0,1,{yoyo:e});this.settled=i.settled,this.update=e=>{i.update(e),n=t[Math.floor(i.value()*(t.length-1))]},this.frame=()=>n}const dt=(t,e,n)=>{let i=e;return s=>{(i+=s)>=e?(t(),i=0):n&&n(i/e)}};function pt(){let t=[];this.add=(e,n=0)=>{t.push({fn:e,delay:n})},this.update=e=>{let n=[];t.forEach(t=>{t.delay-=e,t.delay<0?t.fn():n.push(t)}),t=n}}function ft(t,e,n){const{canvas:i,events:s,layers:{scene:r,zeroLayer:a},frames:o}=e;let c,{bulletWidth:h,candy:{width:u}}=n,l=new ht(()=>new wt(this,e,n));this.init=t=>{c=t.collision};const d=(t,e,n)=>{l.acquire(i=>i.init({x:t,y:e,bent:n,collision:c}))};this.release=t=>{l.release(t)};const p=dt(()=>{let e=t.currentPoint();d(e[0]-.25*h,e[1],-2),d(e[0]+u-.75*h,e[1],2)},100);this.update=t=>{p(t),l.each(e=>e.update(t))},this.render=()=>{l.each(t=>t.render())}}function wt(t,e,n){const{canvas:i,events:s,layers:{scene:r,oneLayer:a},frames:o}=e,{bulletWidth:c}=n;let h;(h=W(o.shoot)).width=c,h.height=c;let u,l,d,p,f=new et,w=new it(0,0,{});this.init=t=>{let e=t.x,n=t.y,i=t.bent;a.add(h),m(e,n,i),p=Z(0,0,.5*c),l=t.collision.add(this,p),d=t.collision};const y=()=>{let t=Math.floor(w.easing(nt.easeInOutQuad)*(u.length-1));return u[t]},m=(t,e,i)=>{f.clear(),f.bent(V([t,e],[t,e-.8*n.height]),.01*i),u=f.points(),w.both(0,1)};this.damage=()=>{g()};const g=()=>{h.remove(),t.release(this),d.remove(l)};this.update=t=>{w.update(.002*t),w.settled()&&g(),(()=>{let t=y();p.move(t[0]+.25*c,t[1]+.25*c)})()},this.render=()=>{let t=y();h.position.set(t[0],t[1]);let e=1-.8*w.progress()*w.progress();h.alpha=e}}Math.PI;function yt(t,e){return Math.random()*(e-t)+t}function mt(t,e,n,i){let s,r,a,o=new ht(()=>new i(this,e,n));this.init=t=>{a=t.collision,s=0,r=t.x};this.release=t=>{o.release(t)};const c=dt(()=>{s++<5&&(t=>{o.acquire(e=>e.init({x:t,collision:a}))})(r)},200),h=()=>{s>0&&0===o.alives()&&t.release(this)};this.update=t=>{c(t),h(),o.each(e=>e.update(t))},this.render=()=>{o.each(t=>t.render())}}function gt(t,e,n){const{canvas:i,events:s,layers:{scene:r,zeroLayer:a},frames:o}=e;let{candy:{width:c}}=n,h=new ht(()=>new vt(this,e,n)),u=new pt;this.explosion=(t,e)=>{let n=.6*c;u.add(()=>l(t,e),0),u.add(()=>l(t+n,e+n,16),100),u.add(()=>l(t-n,e+n,16),200),u.add(()=>l(t+n,e-n,16),200),u.add(()=>l(t-n,e-n,16),400)};const l=(t,e,n=32)=>{h.acquire(i=>i.init({x:t,y:e,w:n}))};this.release=t=>{h.release(t)},this.init=t=>{},this.update=t=>{h.each(e=>e.update(t)),u.update(t)},this.render=()=>{h.each(t=>t.render())}}function vt(t,e,n){const{canvas:i,events:s,layers:{scene:r,twoLayer:a},frames:o}=e;let c,h=new lt(o.explosion,{yoyo:!1});c=W(o.shoot),this.init=t=>{let e=t.x,n=t.y,i=t.w;c.width=i,c.height=i,c.position.set(e,n),a.add(c)};const u=()=>{c.remove(),t.release(this)};this.update=t=>{h.settled()&&u(),h.update(.001*t*4)},this.render=()=>{c.frame=h.frame()}}function bt(t,e,n){const{canvas:i,events:s,config:{SlowUpdateRate:r,FastUpdateRate:a},layers:{scene:o,oneLayer:c},frames:h}=e,{width:u,height:l,candy:{width:d}}=n;let p,f=new gt(t,e,n);(p=W(h.candy)).width=d,p.height=d;let w,y,m,g=new rt,v=new it(0,0,{});const b=.2*d;let x,P;this.init=t=>{let e=t.paths;P=x=10,v.both(0,0),c.add(p),g.init(e),m=Z(0,0,.5*d),y=t.collision.add(this,m),w=t.collision,f.init({})};const L=()=>P/x,M=()=>{p.remove(),t.release(this),w.remove(y)};let C;this.damage=t=>{(()=>{P--,P=Math.max(P,0);let t=v.value();v.both(0,t-1),p.tint=16777213})()};const R=()=>{v.settled()&&(p.tint=13421772),L()<.1&&((()=>{if(C)return;C=!0;let t=g.currentPoint();f.explosion(...t)})(),M())};this.update=t=>{v.update(.01*t),R(),(()=>{let t=g.currentPoint();m.move(t[0]+.25*d,t[1]+.25*d)})(),g.update(t),g.settled()&&M(),f.update(t)},this.render=()=>{let t=v.value(),e=g.currentPoint();p.position.set(e[0],e[1]+-4*t);let n=d-(1-L())*b;p.width=n,p.height=n,f.render()}}function xt(t,e,n){const{canvas:i,events:s,config:{SlowUpdateRate:r,FastUpdateRate:a},layers:{scene:o,oneLayer:c},frames:h}=e,{width:u,height:l,candy:{width:d}}=n;let p=new st({easing:nt.easeInOutQuad,updateRate:.5*r}),f=new st({easing:nt.easeInQuad,updateRate:a}),w=new bt(t,e,n);this.init=t=>{let e=t.x,n=e<.5*u?u:0;p.init(e,-d,e,l-d),f.init(e,l-d,n,0,.1),w.init({collision:t.collision,paths:[p,f]})},this.update=t=>{w.update(t)},this.render=()=>{w.render()}}function Pt(t,e,n){const{canvas:i,events:s,config:{SlowUpdateRate:r,FastUpdateRate:a},layers:{scene:o,oneLayer:c},frames:h}=e,{width:u,height:l,candy:{width:d}}=n;let p=new st({easing:nt.easeInQuad,updateRate:r}),f=new st({easing:nt.linear,updateRate:a}),w=new st({easing:nt.easeOutQuad,updateRate:a}),y=new bt(t,e,n);this.init=t=>{let e=t.x,n=e<.5*u?u:0,i=e<.5*u?0:u;p.init(e,-d,e,l-4*d),f.init(e,l-4*d,n-2*d,.5*l,.4),w.init(n-2*d,.5*l,i,.5*l,.4),y.init({collision:t.collision,paths:[p,f,w]})},this.update=t=>{y.update(t)},this.render=()=>{y.render()}}function Lt(t,e,n){const{canvas:i,events:s,config:{SlowUpdateRate:r,FastUpdateRate:a},layers:{scene:o,oneLayer:c},frames:h}=e,{width:u,height:l,candy:{width:d}}=n;let p=new st({easing:nt.linear,updateRate:r}),f=new bt(t,e,n);this.init=t=>{let e=t.x;p.init(e,-d,e,l-4*d),f.init({collision:t.collision,paths:[p]})},this.update=t=>{f.update(t)},this.render=()=>{f.render()}}function Mt(t,e,n){const i=()=>new mt(t,e,n,xt),s=()=>new mt(t,e,n,Pt),r=()=>new Lt(t,e,n);let a,o,c=[i,i,s,s,r,r];this.init=t=>{o=0,a=c},this.lick=()=>(o%=a.length,a[o++]())}function Ct(t,e,n){const{width:i}=n;let s,r=new Mt(this,e,n),a=new ht(r.lick);this.play=t,this.init=t=>{s=t.collision,r.init({})},this.release=t=>{};const o=dt(()=>{(()=>{let t=yt(0,i-32);a.acquire(e=>e.init({x:t,collision:s}))})()},5e3);this.update=t=>{o(t),a.each(e=>e.update(t))},this.render=()=>{a.each(t=>t.render())}}function Rt(t,e,n){const{width:i}=n;let s=new ht(()=>new At(this,e,n));this.init=t=>{};this.dashing=()=>t.body.dashing(),this.release=t=>{s.release(t)};const r=dt(()=>{(t=>{s.acquire(e=>e.init({x:t}))})(yt(0,i))},500);this.update=t=>{r(t),s.each(e=>e.update(t))},this.render=()=>{s.each(t=>t.render())}}function At(t,e,n){const{canvas:i,events:s,layers:{scene:r,zeroLayer:a},frames:o}=e,{height:c,width:h}=n;let u,l=new lt(o.bounce,{});(u=W(o.candy)).width=16,u.height=16,u.alpha=.1;let d,p,f=new et,w=new it(0,0,{});this.init=t=>{p=t.x,a.add(u),y()};const y=()=>{f.clear(),f.bent(V([p,-8],[p,c]),.01),d=f.points(),w.both(0,1)};this.update=e=>{let n=t.dashing()?2:1;w.update(2e-4*e*n),(t=>{l.update(2e-4*t*10),u.frame=l.frame()})(e),w.settled()&&t.release(this)},this.render=()=>{let t=(()=>{let t=Math.floor(w.easing(nt.easeInQuad)*(d.length-1));return d[t]})();u.position.set(t[0],t[1])}}function St(t,e,n){const{canvas:i,events:s,layers:{scene:r,zeroLayer:a},frames:o}=e;let c=new zt(this,e,n),h=new ft(this,e,n),u=new Ct(this,e,n),l=new Rt(this,e,n),d=new ut(this,e,n),p=new ct;this.body=c,this.currentPoint=c.currentPoint,this.init=t=>{d.init({collision:p}),c.init({collision:{add:p.addCandy,remove:p.removeCandy}}),h.init({collision:{add:p.addShoot,remove:p.removeShoot}}),u.init({collision:{add:p.addLollipop,remove:p.removeLollipop}}),l.init({}),r.background(.1,.2,.2)},this.update=t=>{c.update(t),h.update(t),u.update(t),l.update(t),p.update(t),d.update(t)},this.render=()=>{c.render(),h.render(),u.render(),l.render()}}function zt(t,e,n){const{canvas:i,events:s,config:{candy:{SlowUpdateRate:r,FastUpdateRate:a}},layers:{scene:o,twoLayer:c},frames:h}=e;let u,l,d,{width:p,height:f,candy:{width:w}}=n,y=(new lt(h.bounce,{}),new st({yoyo:!0,updateRate:r})),m=new st({yoyo:!1,updateRate:2*a}),g=new st({yoyo:!1,updateRate:a}),v=f-w,b=f-10*w;(l=W(h.candy)).width=32,l.height=32,this.init=t=>{let e=.5*p,n=v;x([e,n]),d=Z(e,n,.5*w),t.collision.add(this,d),c.add(l)};const x=(t=this.currentPoint())=>{y.init(t[0],t[1],t[0]+.5*w,t[1],-.1),u=y},P=t=>{let e=this.currentPoint(),n=Math.sign(e[0]-t);m.init(e[0],e[1],t,e[1],.1*n),u=m},L=t=>{let e=this.currentPoint();g.init(e[0],e[1],e[0],t,.1),u=g};this.currentPoint=()=>u.currentPoint(),this.dashing=()=>u===g;const M=()=>{let t=this.currentPoint();d.move(t[0]+.25*w,t[1]+.25*w)};this.update=t=>{u.update(t),(()=>{const{current:t}=s.data;if(t){let{epos:e,ending:n}=t;if(n){let{swipe:{swiped:t,up:i,down:s}}=n;t?i?L(b):s&&L(v):P(e[0])}}})(),M(),u===m&&u.settled()&&x(),u===g&&u.settled()&&x()},this.render=()=>{let t=u.currentPoint();l.position.set(t[0],t[1])}}function Ot(t){const{canvas:e,layers:{scene:n,zeroLayer:i},frames:s}=t;let r=new St(this,t,(()=>{const{width:t,height:n}=e;return{width:t,height:n,bulletWidth:32,candy:function(t,e,n,i){return new J(t,e,n,i)}(0,0,32,32)}})());this.init=t=>{r.init({})},this.update=t=>{r.update(t)},this.render=()=>{r.render()}}function Ut(t,e){new h({candy:"candy.png",shoot:"cshoot.png"},{assetsUrl:"assets/images/"}).start().then(e=>{const n=new q(t),i=new I(n);i.bindTouch();const s=function(t,e){const n=t.texture(e.candy),i=G(n);return{white:t.texture(Y("white")),shoot:X(t,e.shoot,32),explosion:N(i,0,32,32,8),candy:i(0,0,32),bounce:N(i,0,0,32,6)}}(n.scene,e);let r=new Ot({config:{candy:{SlowUpdateRate:4e-4,FastUpdateRate:8e-4},FastUpdateRate:4e-4,SlowUpdateRate:2e-4},events:i,assets:e,canvas:n,frames:s,layers:D(n.scene)});r.init({}),new o(t=>{i.update(t),r.update(t),r.render(),n.scene.render()}).start()})}n.d(e,"app",function(){return Ut})}]);